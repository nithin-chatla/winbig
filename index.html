<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinBig - Low Cost Entry, Big Surprise Gifts!</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #f59e0b; /* Amber */
            --primary-hover: #d97706;
            --secondary-bg: #111827; /* Dark Gray */
            --card-bg: #1f2937;
            --border-color: #374151;
            --text-light: #f9fafb;
            --text-dark: #d1d5db;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--secondary-bg);
            color: var(--text-dark);
            margin: 0;
            opacity: 0;
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 2rem; background-color: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 10;
        }
        nav .logo { font-size: 1.75rem; font-weight: 800; color: var(--primary-color); }
        nav .nav-links a {
            margin-left: 1.5rem; text-decoration: none; color: var(--text-dark);
            font-weight: 500; transition: color 0.2s;
        }
        nav .nav-links a:hover { color: var(--primary-color); }
        main { padding: 2rem; max-width: 1200px; margin: auto; }
        .hero {
            text-align: center; padding: 4rem 1rem;
            animation: slideUp 0.7s ease-out;
        }
        .hero h1 {
            font-size: 3.5rem; font-weight: 800; color: var(--text-light);
            margin: 0 0 1rem;
        }
        .hero .highlight { color: var(--primary-color); }
        .hero p { font-size: 1.25rem; max-width: 600px; margin: 0 auto 2rem; }
        .btn-primary {
            background-color: var(--primary-color); color: var(--secondary-bg);
            padding: 0.8rem 2rem; border-radius: 6px; text-decoration: none;
            font-weight: 700; transition: all 0.2s; display: inline-block;
        }
        .btn-primary:hover { background-color: var(--primary-hover); transform: translateY(-2px); }
        .section-title { text-align: center; font-size: 2.5rem; font-weight: 700; margin-bottom: 2rem; color: var(--text-light); }
        .prizes-grid, .winners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 4rem;
        }
        .prize-card, .winner-card {
            background-color: var(--card-bg); border-radius: 8px;
            border: 1px solid var(--border-color); overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .prize-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .card-content { padding: 1.5rem; }
        .prize-card h3 { margin: 0 0 0.5rem; font-size: 1.5rem; color: var(--text-light); }
        .prize-card .price { font-size: 1.2rem; color: var(--primary-color); font-weight: 600; }
        .prize-card .date { font-size: 0.9rem; color: var(--text-dark); margin-top: 1rem; }
        .container {
            background-color: var(--card-bg); padding: 2rem; border-radius: 8px;
            border: 1px solid var(--border-color); max-width: 600px; margin: 4rem auto;
        }
        form { display: flex; flex-direction: column; gap: 1rem; }
        input, select {
            padding: 0.75rem; border-radius: 6px; border: 1px solid var(--border-color);
            background-color: #374151; color: var(--text-light); font-size: 1rem;
        }
        .message { text-align: center; padding: 1rem; border-radius: 6px; margin: 1rem 0; font-weight: 500; display: none; }
        .success { background-color: #166534; color: #dcfce7; }
        .error { background-color: #991b1b; color: #fee2e2; }
        .loader {
            border: 3px solid var(--border-color); border-top: 3px solid var(--primary-color);
            border-radius: 50%; width: 24px; height: 24px;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <nav>
        <div class="logo">WinBig</div>
        <div class="nav-links">
            <a href="#prizes">Prizes</a>
            <a href="#request">Request Ticket</a>
            <a href="./agent.html">Agent Login</a>
            <a href="./admin.html">Admin</a>
        </div>
    </nav>
    <main>
        <section class="hero">
            <h1>Win <span class="highlight">Incredible Prizes</span> for Less</h1>
            <p>Your chance to win big is just one ticket away. Explore our latest giveaways and join the excitement!</p>
            <a href="#prizes" class="btn-primary">See Active Prizes</a>
        </section>

        <section id="prizes" style="animation-delay: 0.2s;">
            <h2 class="section-title">Current Giveaways</h2>
            <div id="prizes-list" class="prizes-grid"><div class="loader"></div></div>
        </section>

        <section id="request" style="animation-delay: 0.4s;">
            <div class="container">
                <h2 class="section-title" style="margin-bottom: 1rem;">Request a Ticket</h2>
                <p style="text-align: center; margin-top: 0; margin-bottom: 2rem;">An agent will contact you shortly to confirm your ticket.</p>
                <form id="submit-request-form">
                    <select id="request-prize-select" required><option value="" disabled selected>Loading prizes...</option></select>
                    <input type="text" id="request-customer-name" placeholder="Your Full Name" required>
                    <input type="tel" id="request-customer-phone" placeholder="Your Phone Number" required>
                    <button type="submit" class="btn-primary" style="border: none; width: 100%; font-size: 1rem;">Send Request</button>
                </form>
                <div id="request-message" class="message"></div>
            </div>
        </section>
    </main>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, query, where } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCP7extT3aBFU8Pzo95_zbmKviMGVRQt9E",
            authDomain: "winbig-83d30.firebaseapp.com",
            projectId: "winbig-83d30",
            storageBucket: "winbig-83d30.appspot.com",
            messagingSenderId: "752719565889",
            appId: "1:752719565889:web:9ff8c0768d9a01146ee2c0",
            measurementId: "G-JBRRS6HQXF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const prizesListDiv = document.getElementById('prizes-list');
        const requestPrizeSelect = document.getElementById('request-prize-select');

        async function fetchPrizes() {
            try {
                const q = query(collection(db, "lotteries"), where("isActive", "==", true));
                const querySnapshot = await getDocs(q);
                const prizes = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                prizes.sort((a,b) => new Date(a.drawDate) - new Date(b.drawDate));

                prizesListDiv.innerHTML = '';
                requestPrizeSelect.innerHTML = '<option value="" disabled selected>Select a prize...</option>';
                
                if (prizes.length === 0) {
                    prizesListDiv.innerHTML = '<p>No active prizes at the moment. Check back soon!</p>';
                    return;
                }

                prizes.forEach(prize => {
                    // Populate prize cards
                    const card = document.createElement('div');
                    card.className = 'prize-card';
                    card.innerHTML = `
                        <div class="card-content">
                            <h3>${prize.prizeName}</h3>
                            <p class="price">Ticket: ₹${prize.ticketPrice}</p>
                            <p class="date">Draw Date: ${new Date(prize.drawDate).toLocaleDateString()}</p>
                        </div>
                    `;
                    prizesListDiv.appendChild(card);

                    // Populate select dropdown
                    const option = document.createElement('option');
                    option.value = prize.prizeName;
                    option.textContent = `${prize.prizeName} (₹${prize.ticketPrice})`;
                    requestPrizeSelect.appendChild(option);
                });
            } catch (error) {
                console.error("Error fetching prizes: ", error);
                prizesListDiv.innerHTML = '<p class="error">Could not load prizes. Please try again later.</p>';
            }
        }
        
        const requestForm = document.getElementById('submit-request-form');
        const requestMessage = document.getElementById('request-message');

        requestForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = requestForm.querySelector('button');
            submitButton.disabled = true;
            submitButton.textContent = 'Sending...';
            try {
                await addDoc(collection(db, "leads"), {
                    customerName: document.getElementById('request-customer-name').value,
                    customerPhone: document.getElementById('request-customer-phone').value,
                    selectedPrize: document.getElementById('request-prize-select').value,
                    status: 'unclaimed', // NEW: Set status to unclaimed
                    createdAt: new Date()
                });
                requestMessage.textContent = 'Your request has been sent! An agent will contact you soon.';
                requestMessage.className = 'message success';
                requestForm.reset();
            } catch (error) {
                console.error("Error submitting request: ", error);
                requestMessage.textContent = 'Something went wrong. Please try again.';
                requestMessage.className = 'message error';
            } finally {
                requestMessage.style.display = 'block';
                submitButton.disabled = false;
                submitButton.textContent = 'Send Request';
            }
        });

        fetchPrizes();
    </script>
</body>
</html>

